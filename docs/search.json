[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Test Quarto Book",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books."
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "This is a book created from markdown and executable code.\nSee @knuth84 for additional discussion of literate programming."
  },
  {
    "objectID": "Rcode.html",
    "href": "Rcode.html",
    "title": "2  R code",
    "section": "",
    "text": "a = 5\na\n\n[1] 5"
  },
  {
    "objectID": "spatial_transcriptome.html#data-download",
    "href": "spatial_transcriptome.html#data-download",
    "title": "3  Gouin et al.",
    "section": "3.1 Data download",
    "text": "3.1 Data download\n\n!mkdir -p Gouin-2021-Nat_Commun-Bladder_cancer/single_cell\n!mkdir -p Gouin-2021-Nat_Commun-Bladder_cancer/spatial\n\n\n3.1.1 snRNA-seq\nSingle-nuclei RNA-seq data is reposited in Gene Expression Omnibus with accession number GSE169379\n\n3.1.1.1 Metadata\n\n!wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/matrix/GSE169379_series_matrix.txt.gz -O Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_series_matrix.txt.gz\n\n--2021-12-26 18:51:06--  ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/matrix/GSE169379_series_matrix.txt.gz\n           => 'Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_series_matrix.txt.gz'\nResolving ftp.ncbi.nlm.nih.gov... 130.14.250.7, 165.112.9.229\nConnecting to ftp.ncbi.nlm.nih.gov|130.14.250.7|:21... connected.\nLogging in as anonymous ... Logged in!\n==> SYST ... done.    ==> PWD ... done.\n==> TYPE I ... done.  ==> CWD (1) /geo/series/GSE169nnn/GSE169379/matrix ... done.\n==> SIZE GSE169379_series_matrix.txt.gz ... 6404\n==> PASV ... done.    ==> RETR GSE169379_series_matrix.txt.gz ... done.\nLength: 6404 (6.3K) (unauthoritative)\n\n100%[======================================>] 6,404       --.-K/s   in 0.04s   \n\n2021-12-26 18:51:08 (179 KB/s) - 'Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_series_matrix.txt.gz' saved [6404]\n\n\n\n\nn_sample = 30\nwith gzip.open(\"Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_series_matrix.txt.gz\", \"rt\") as fi:\n    meta = []\n    for i,j in enumerate(fi):\n        dat = j.strip('\\n!').split(\"\\t\")\n        if len(dat) != n_sample + 1: continue\n        dat = [d.strip('\"') for d in dat]\n        meta.append(dat)\nmeta = pd.DataFrame(meta).set_index(0).T.set_index(\"ID_REF\").iloc[:,[0, 8, 9]]\nmeta.columns = [\"sample_title\", \"organism\", \"tissue\"]\nmeta = meta.assign(sample_id = lambda x: [y.split(\": \")[0] for y in x.sample_title],\n                   donor_id = lambda x: [y.split(\": \")[1] for y in x.sample_title],\n                   tissue = lambda x: [y.split(\": \")[1] for y in x.tissue])\nmeta\n\n\n\n\n\n  \n    \n      \n      sample_title\n      organism\n      tissue\n      sample_id\n      donor_id\n    \n    \n      ID_REF\n      \n      \n      \n      \n      \n    \n  \n  \n    \n      GSM5199001\n      B1246-GEX: MIBC_rxn1246\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B1246-GEX\n      MIBC_rxn1246\n    \n    \n      GSM5199003\n      B1246-HTO: MIBC_rxn1246\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B1246-HTO\n      MIBC_rxn1246\n    \n    \n      GSM5199004\n      B1-GEX: MIBC_rxn1\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B1-GEX\n      MIBC_rxn1\n    \n    \n      GSM5199005\n      B1-HTO: MIBC_rxn1\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B1-HTO\n      MIBC_rxn1\n    \n    \n      GSM5199006\n      B2-GEX: MIBC_rxn2\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B2-GEX\n      MIBC_rxn2\n    \n    \n      GSM5199007\n      B2-HTO: MIBC_rxn2\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B2-HTO\n      MIBC_rxn2\n    \n    \n      GSM5199008\n      B3-GEX: MIBC_rxn3\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B3-GEX\n      MIBC_rxn3\n    \n    \n      GSM5199009\n      B3-HTO: MIBC_rxn3\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B3-HTO\n      MIBC_rxn3\n    \n    \n      GSM5199011\n      B4-GEX: MIBC_rxn4\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B4-GEX\n      MIBC_rxn4\n    \n    \n      GSM5199012\n      B4-HTO: MIBC_rxn4\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B4-HTO\n      MIBC_rxn4\n    \n    \n      GSM5199013\n      B5A-GEX: MIBC_rxn5A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B5A-GEX\n      MIBC_rxn5A\n    \n    \n      GSM5199014\n      B5A-HTO: MIBC_rxn5A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B5A-HTO\n      MIBC_rxn5A\n    \n    \n      GSM5199015\n      B5B-GEX: MIBC_rxn5B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B5B-GEX\n      MIBC_rxn5B\n    \n    \n      GSM5199016\n      B5B-HTO: MIBC_rxn5B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B5B-HTO\n      MIBC_rxn5B\n    \n    \n      GSM5199017\n      B6A-GEX: MIBC_rxn6A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B6A-GEX\n      MIBC_rxn6A\n    \n    \n      GSM5199019\n      B6A-HTO: MIBC_rxn6A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B6A-HTO\n      MIBC_rxn6A\n    \n    \n      GSM5199020\n      B6B-GEX: MIBC_rxn6B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B6B-GEX\n      MIBC_rxn6B\n    \n    \n      GSM5199021\n      B6B-HTO: MIBC_rxn6B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B6B-HTO\n      MIBC_rxn6B\n    \n    \n      GSM5199022\n      B7A-GEX: MIBC_rxn7A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B7A-GEX\n      MIBC_rxn7A\n    \n    \n      GSM5199023\n      B7A-HTO: MIBC_rxn7A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B7A-HTO\n      MIBC_rxn7A\n    \n    \n      GSM5199025\n      B7B-GEX: MIBC_rxn7B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B7B-GEX\n      MIBC_rxn7B\n    \n    \n      GSM5199026\n      B7B-HTO: MIBC_rxn7B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B7B-HTO\n      MIBC_rxn7B\n    \n    \n      GSM5199027\n      B8A-GEX: MIBC_rxn8A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B8A-GEX\n      MIBC_rxn8A\n    \n    \n      GSM5199028\n      B8A-HTO: MIBC_rxn8A\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B8A-HTO\n      MIBC_rxn8A\n    \n    \n      GSM5199029\n      B8B-GEX: MIBC_rxn8B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B8B-GEX\n      MIBC_rxn8B\n    \n    \n      GSM5199030\n      B8B-HTO: MIBC_rxn8B\n      Homo sapiens\n      muscle-invasive bladder cancer (MIBC)\n      B8B-HTO\n      MIBC_rxn8B\n    \n    \n      GSM5199031\n      normalA: normal_sampleA\n      Homo sapiens\n      normal bladder\n      normalA\n      normal_sampleA\n    \n    \n      GSM5199033\n      normalB: normal_sampleB\n      Homo sapiens\n      normal bladder\n      normalB\n      normal_sampleB\n    \n    \n      GSM5199034\n      normalC: normal_sampleC\n      Homo sapiens\n      normal bladder\n      normalC\n      normal_sampleC\n    \n    \n      GSM5199035\n      normalD: normal_sampleD\n      Homo sapiens\n      normal bladder\n      normalD\n      normal_sampleD\n    \n  \n\n\n\n\n\n\n3.1.1.2 Expression\n\n!wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/suppl/GSE169379_MIBC_snSeq.h5ad.gz -O Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_MIBC_snSeq.h5ad.gz\n!gunzip Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_MIBC_snSeq.h5ad.gz\n\n--2021-12-26 18:59:04--  ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/suppl/GSE169379_MIBC_snSeq.h5ad.gz\n           => 'GSE169379_MIBC_snSeq.h5ad.gz'\nResolving ftp.ncbi.nlm.nih.gov... 130.14.250.13, 165.112.9.229\nConnecting to ftp.ncbi.nlm.nih.gov|130.14.250.13|:21... connected.\nLogging in as anonymous ... Logged in!\n==> SYST ... done.    ==> PWD ... done.\n==> TYPE I ... done.  ==> CWD (1) /geo/series/GSE169nnn/GSE169379/suppl ... done.\n==> SIZE GSE169379_MIBC_snSeq.h5ad.gz ... 473158739\n==> PASV ... done.    ==> RETR GSE169379_MIBC_snSeq.h5ad.gz ... done.\nLength: 473158739 (451M) (unauthoritative)\n\n100%[======================================>] 473,158,739 5.99MB/s   in 85s    \n\n2021-12-26 19:00:31 (5.33 MB/s) - 'GSE169379_MIBC_snSeq.h5ad.gz' saved [473158739]\n\n\n\n\n!wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/suppl/GSE169379_non_tumor_snSeq.h5ad.gz -O Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_non_tumor_snSeq.h5ad.gz\n!gunzip Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_non_tumor_snSeq.h5ad.gz\n\n--2021-12-26 19:16:36--  ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE169nnn/GSE169379/suppl/GSE169379_non_tumor_snSeq.h5ad.gz\n           => 'Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_non_tumor_snSeq.h5ad.gz'\nResolving ftp.ncbi.nlm.nih.gov... 130.14.250.13, 165.112.9.229\nConnecting to ftp.ncbi.nlm.nih.gov|130.14.250.13|:21... connected.\nLogging in as anonymous ... Logged in!\n==> SYST ... done.    ==> PWD ... done.\n==> TYPE I ... done.  ==> CWD (1) /geo/series/GSE169nnn/GSE169379/suppl ... done.\n==> SIZE GSE169379_non_tumor_snSeq.h5ad.gz ... 87784694\n==> PASV ... done.    ==> RETR GSE169379_non_tumor_snSeq.h5ad.gz ... done.\nLength: 87784694 (84M) (unauthoritative)\n\n100%[======================================>] 87,784,694  4.35MB/s   in 18s    \n\n2021-12-26 19:16:56 (4.66 MB/s) - 'Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_non_tumor_snSeq.h5ad.gz' saved [87784694]\n\n\n\n\nadata = sc.read_h5ad(\"Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_MIBC_snSeq.h5ad\")\nadata\n\n\nadata = sc.read_h5ad(\"Gouin-2021-Nat_Commun-Bladder_cancer/single_cell/GSE169379_non_tumor_snSeq.h5ad\")\nadata\n\n\n\n\n3.1.2 Spatial transcriptomics\nSpatial transcriptome data is reposited in Gene Expression Omnibus with accession number GSE171351\n\n!wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE171nnn/GSE171351/suppl/GSE171351_combined_visium.h5ad.gz -O Gouin-2021-Nat_Commun-Bladder_cancer/spatial/GSE171351_combined_visium.h5ad.gz\n!gunzip Gouin-2021-Nat_Commun-Bladder_cancer/spatial/GSE171351_combined_visium.h5ad.gz\n\n--2021-12-26 19:23:01--  ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE171nnn/GSE171351/suppl/GSE171351_combined_visium.h5ad.gz\n           => 'Gouin-2021-Nat_Commun-Bladder_cancer/spatial/GSE171351_combined_visium.h5ad.gz'\nResolving ftp.ncbi.nlm.nih.gov... 165.112.9.229, 130.14.250.13\nConnecting to ftp.ncbi.nlm.nih.gov|165.112.9.229|:21... connected.\nLogging in as anonymous ... Logged in!\n==> SYST ... done.    ==> PWD ... done.\n==> TYPE I ... done.  ==> CWD (1) /geo/series/GSE171nnn/GSE171351/suppl ... done.\n==> SIZE GSE171351_combined_visium.h5ad.gz ... 48963566\n==> PASV ... done.    ==> RETR GSE171351_combined_visium.h5ad.gz ... done.\nLength: 48963566 (47M) (unauthoritative)\n\n100%[======================================>] 48,963,566  6.24MB/s   in 9.5s   \n\n2021-12-26 19:23:13 (4.92 MB/s) - 'Gouin-2021-Nat_Commun-Bladder_cancer/spatial/GSE171351_combined_visium.h5ad.gz' saved [48963566]"
  },
  {
    "objectID": "spatial_transcriptome.html#analysis",
    "href": "spatial_transcriptome.html#analysis",
    "title": "3  Gouin et al.",
    "section": "3.2 Analysis",
    "text": "3.2 Analysis\n\nadata = sc.read_h5ad(\"Gouin-2021-Nat_Commun-Bladder_cancer/spatial/GSE171351_combined_visium.h5ad\")\nadata\n\nAnnData object with n_obs × n_vars = 4086 × 33538\n    obs: 'in_tissue', 'array_row', 'array_col', 'sampleID', 'Patient', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes', 'total_counts_mt', 'log1p_total_counts_mt', 'pct_counts_mt', 'n_counts'\n    var: 'gene_ids', 'feature_types', 'genome', 'mt', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts'\n    uns: 'spatial'\n    obsm: 'spatial'\n\n\n\nadata.obs\n\n\n\n\n\n  \n    \n      \n      in_tissue\n      array_row\n      array_col\n      sampleID\n      Patient\n      n_genes_by_counts\n      log1p_n_genes_by_counts\n      total_counts\n      log1p_total_counts\n      pct_counts_in_top_50_genes\n      pct_counts_in_top_100_genes\n      pct_counts_in_top_200_genes\n      pct_counts_in_top_500_genes\n      total_counts_mt\n      log1p_total_counts_mt\n      pct_counts_mt\n      n_counts\n    \n  \n  \n    \n      AAACCGTTCGTCCAGG-1-0-0-0\n      1\n      52\n      42\n      A1\n      Bladder1204\n      1221\n      7.108244\n      1696.0\n      7.436617\n      18.396226\n      26.356132\n      38.148585\n      57.488208\n      48.0\n      3.891820\n      2.830189\n      1696.0\n    \n    \n      AAACGAGACGGTTGAT-1-0-0-0\n      1\n      35\n      79\n      A1\n      Bladder1204\n      3257\n      8.088869\n      6578.0\n      8.791638\n      16.950441\n      23.532989\n      32.335056\n      47.978109\n      113.0\n      4.736198\n      1.717847\n      6578.0\n    \n    \n      AAACTGCTGGCTCCAA-1-0-0-0\n      1\n      45\n      67\n      A1\n      Bladder1204\n      3385\n      8.127405\n      6858.0\n      8.833317\n      19.072616\n      25.590551\n      33.712453\n      48.235637\n      159.0\n      5.075174\n      2.318460\n      6858.0\n    \n    \n      AAAGGCTACGGACCAT-1-0-0-0\n      1\n      62\n      54\n      A1\n      Bladder1204\n      2392\n      7.780303\n      4399.0\n      8.389359\n      19.686292\n      27.301659\n      36.758354\n      52.716526\n      125.0\n      4.836282\n      2.841555\n      4399.0\n    \n    \n      AAAGGCTCTCGCGCCG-1-0-0-0\n      1\n      55\n      55\n      A1\n      Bladder1204\n      1963\n      7.582738\n      3184.0\n      8.066208\n      20.069095\n      27.386935\n      36.777638\n      54.051508\n      59.0\n      4.094345\n      1.853015\n      3184.0\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      TTGTGCAGCCACGTCA-1-1\n      1\n      60\n      74\n      D1\n      Bladder371\n      1031\n      6.939254\n      1596.0\n      7.375882\n      26.190476\n      34.774436\n      47.305764\n      66.729323\n      129.0\n      4.867535\n      8.082706\n      1596.0\n    \n    \n      TTGTGGCCCTGACAGT-1-1\n      1\n      18\n      60\n      D1\n      Bladder371\n      3102\n      8.040125\n      7971.0\n      8.983690\n      22.682223\n      32.003513\n      43.206624\n      58.650107\n      305.0\n      5.723585\n      3.826370\n      7971.0\n    \n    \n      TTGTGTTTCCCGAAAG-1-1\n      1\n      51\n      59\n      D1\n      Bladder371\n      1288\n      7.161622\n      2108.0\n      7.653969\n      23.292220\n      32.874763\n      44.165085\n      62.618596\n      120.0\n      4.795791\n      5.692600\n      2108.0\n    \n    \n      TTGTTAGCAAATTCGA-1-1\n      1\n      22\n      42\n      D1\n      Bladder371\n      2112\n      7.655864\n      4357.0\n      8.379768\n      22.125316\n      31.237090\n      42.299748\n      59.742942\n      245.0\n      5.505332\n      5.623136\n      4357.0\n    \n    \n      TTGTTCAGTGTGCTAC-1-1\n      1\n      24\n      64\n      D1\n      Bladder371\n      3010\n      8.010028\n      7805.0\n      8.962648\n      22.152466\n      31.800128\n      42.588085\n      58.436899\n      211.0\n      5.356586\n      2.703395\n      7805.0\n    \n  \n\n4086 rows × 17 columns\n\n\n\n\nadata.var[\"mt\"] = adata.var_names.str.startswith(\"MT-\")\nsc.pp.calculate_qc_metrics(adata, qc_vars=[\"mt\"], inplace=True)\n#sc.pp.filter_cells(adata, min_counts=5000)\nadata = adata[adata.obs.in_tissue != 0, :]\nsc.pp.normalize_total(adata, inplace=True)\nsc.pp.log1p(adata)\n\n/Users/maruyamatooru/opt/anaconda3/envs/spatial/lib/python3.8/site-packages/scanpy/preprocessing/_normalization.py:138: UserWarning: Revieved a view of an AnnData. Making a copy.\n  view_to_actual(adata)\n\n\n\ngenes = [\"in_tissue\"]\nfor id in [\"A1\", \"B1\", \"C1\", \"D1\"]:\n    sc.pl.spatial(adata[adata.obs.sampleID == id, :], \n                  img_key=\"lowres\", \n                  color=genes,\n                  alpha=1, \n                  library_id=id)\n\nNameError: name 'sc' is not defined"
  }
]